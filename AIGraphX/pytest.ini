# pytest.ini
# Pytest 的配置文件。Pytest 是一个流行的 Python 测试框架。
# 这个文件用于定制 Pytest 的行为。

[pytest]
# --- Asyncio 设置 ---
# 指定 pytest-asyncio 插件的模式。
# 'auto' 模式会自动检测测试函数是同步还是异步，并选择合适的运行方式。
# 这是推荐的模式，可以无缝地运行 `async def` 和 `def` 测试函数。
asyncio_mode = auto

# --- 默认异步 Fixture 的事件循环作用域 ---
# 设置由 pytest-asyncio 管理的默认事件循环的作用域。
# 'function' (默认值): 每个测试函数都会获取一个新的、独立的事件循环。这提供了最佳的测试隔离性，
#                      因为一个测试中的异步操作不会影响到另一个测试的事件循环。
# 'session': 所有测试函数共享同一个事件循环。这可以提高某些情况下的测试速度（减少循环创建开销），
#            但在测试之间可能引入状态污染或难以调试的并发问题，尤其是在 teardown 阶段
#            涉及耗时异步操作时（如关闭数据库连接池）。
#            **本项目推荐使用 'function' 作用域以保证隔离性。**
asyncio_default_fixture_loop_scope = function
# asyncio_default_fixture_loop_scope = session # 注释掉，明确使用默认的 function 作用域。